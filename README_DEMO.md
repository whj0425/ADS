# 分布式银行系统演示指南

本文档提供了如何在两台电脑上演示分布式银行系统的详细说明。

## 系统架构

分布式银行系统由以下几个主要组件组成：

1. **事务协调器(Transaction Coordinator)**: 负责协调分布式事务的执行，实现两阶段提交协议
2. **账户节点(Account Node)**: 维护银行账户的数据，分为主节点和备份节点
3. **客户端(Client)**: 提供用户界面，允许用户执行账户查询和转账操作

## 两台电脑部署方案

我们采用以下部署方案在两台电脑上演示分布式系统：

**电脑A**:
- 运行事务协调器(Transaction Coordinator)
- 运行账户节点a1和备份a1b
- 运行客户端

**电脑B**:
- 运行账户节点a2和备份a2b
- 运行客户端

## 准备工作

在开始演示之前，请确保：

1. 两台电脑都已安装Python 3.6+
2. 两台电脑网络互通（可以相互ping通）
3. 在两台电脑上都克隆/复制了完整的项目代码
4. 修改`start_computer_A.py`和`start_computer_B.py`中的IP地址配置：
   - 在`start_computer_A.py`中设置`COMPUTER_A_IP`为电脑A的实际IP地址
   - 在`start_computer_B.py`中设置`COMPUTER_A_IP`为电脑A的实际IP地址
   - 在两个脚本中都设置`COMPUTER_B_IP`为电脑B的实际IP地址

## 启动步骤

### 电脑A上的操作

1. 打开终端，进入项目目录
2. 执行以下命令启动电脑A上的组件：
   ```bash
   python start_computer_A.py
   ```
3. 脚本将自动启动：
   - 事务协调器
   - 账户节点a1（主节点）
   - 账户节点a1b（备份节点）
   - 客户端

### 电脑B上的操作

1. 在电脑A启动完成后，在电脑B上打开终端，进入项目目录
2. 执行以下命令启动电脑B上的组件：
   ```bash
   python start_computer_B.py
   ```
3. 脚本将自动启动：
   - 账户节点a2（主节点）
   - 账户节点a2b（备份节点）
   - 客户端

## 演示场景

启动完成后，您可以使用以下工具进行系统演示：

### 演示脚本

在任何一台电脑上，您可以运行演示脚本来执行各种演示场景：
```bash
python demo_scenarios.py [协调器IP] [协调器端口]
```

演示脚本提供了以下功能：
1. 转账演示：演示正常的转账操作
2. 故障恢复演示：模拟节点故障并展示系统恢复过程
3. 并发转账演示：展示系统处理并发事务的能力
4. 列出所有账户：查看当前系统中的所有账户节点
5. 检查节点状态：检查特定节点的状态
6. 模拟节点故障：手动触发节点故障

### 客户端操作

您也可以直接使用自动启动的客户端执行以下操作：
- `list`: 列出所有可用账户
- `transfer <from> <to> <amount>`: 转账操作，例如 `transfer a1 a2 100`
- `init <amount>`: 初始化所有账户余额
- `balance <account_id>`: 查询账户余额
- `help`: 显示帮助信息
- `exit`: 退出客户端

## 演示流程建议

以下是推荐的演示流程：

1. **基本功能演示**:
   - 使用客户端初始化账户余额
   - 查询各账户余额
   - 执行简单转账并验证余额变化

2. **跨节点转账演示**:
   - 在电脑A上发起从a1到a2的转账
   - 在电脑B上发起从a2到a1的转账
   - 验证两笔转账都成功完成

3. **故障恢复演示**:
   - 在电脑A上运行`demo_scenarios.py`
   - 选择"模拟节点故障"选项，输入`a1`模拟主节点故障
   - 在故障期间执行从a1到a2的转账
   - 观察备份节点a1b如何接管并完成转账
   - 恢复a1节点，并观察数据同步过程

4. **并发操作演示**:
   - 在电脑A上运行`demo_scenarios.py`
   - 选择"并发转账演示"
   - 观察系统如何处理并发事务并保持一致性

## 常见问题

1. **连接超时**:
   - 确保两台电脑网络互通
   - 检查IP地址设置是否正确
   - 确保防火墙未阻止相关端口

2. **节点未正确配对**:
   - 重启系统，确保按正确的顺序启动各组件
   - 检查日志输出，确认协调器是否正确识别了节点关系

3. **转账失败**:
   - 检查账户余额是否充足
   - 确保相关节点都处于活跃状态
   - 查看日志输出，了解详细错误信息

## 总结

通过这个两台电脑的部署演示，我们可以直观地展示分布式系统的以下关键特性：

1. **分布式通信**: 不同电脑上的节点如何通过网络进行通信
2. **一致性保证**: 分布式事务如何确保数据一致性
3. **容错机制**: 系统如何处理节点故障并通过备份节点恢复服务
4. **并发控制**: 系统如何处理并发操作并防止数据竞争 