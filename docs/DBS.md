### 2.1 节点结构
- **节点类型 1**: 账户节点（每个代表一个银行账户）
- **节点类型 2**: 交易协调节点（负责资金转账协调）

### 2.2 数据存储和持久化

#### 2.2.1 数据组织
- 每个节点在本地JSON文件中存储数据：
  - 账户数据（账户ID、余额、交易历史）
  - 交易日志（交易ID、来源、目标、金额、状态、时间戳）
  - 无需外部数据库


### 2.3 通信模式
- 节点间直接TCP/IP套接字通信
- 基于消息的协议
- 关键操作的同步通信
- 心跳机制监控节点健康状态

## 3. 重点银行操作：资金转账

### 3.1 资金转账流程
- 发起：客户请求从账户A转账到账户B
- 验证：验证账户A中资金是否充足
- 锁定：在交易期间锁定两个账户
- 执行：扣除账户A并增加账户B
- 确认：更新交易状态并释放锁
- 记录：在历史记录中记录交易

### 3.2 并发控制演示
- **两阶段锁定（2PL）**：
  - 在任何修改前获取两个账户的锁
  - 在交易完成前保持锁定
  - 完成后释放锁
  
- **死锁预防**：
  - 账户锁的全局排序（例如，按账户ID）
  - 锁获取的超时机制

### 3.3 一致性演示
- **两阶段提交协议（2PC）**：
  - 第1阶段：协调者询问所有账户是否可以提交
  - 第2阶段：如果都同意，协调者告知所有人提交；否则中止

## 4. 分布式系统机制

### 4.1 状态复制
- 每个账户节点维护账户数据的主要副本
- 简单复制到备份节点以实现容错
- 一致性协议确保所有副本都更新

### 4.2 容错能力

#### 4.2.1 故障检测的心跳机制
- **实现方法**：
  - 每个节点向其他节点发送定期心跳消息
  - 如果在超时期限内未收到心跳，则认为节点故障

#### 4.2.2 基本复制策略
- **主-备份复制**：
  - 每个账户节点有1个指定的备份节点
  - 主节点同步复制所有更新到备份节点
  - 定期执行完整状态同步

#### 4.2.3 处理节点故障
- **账户节点故障**：
  - 当主账户节点故障时，备份节点升级为主节点
  - 新的主节点在系统注册表中更新其状态
  - 客户端通过注册表重定向到新的主节点


## 5. 测试策略

### 5.1 并发测试
- 向相同账户同时发出多个转账请求
- 验证最终账户余额
- 检测竞争条件


